
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gastric Cancer Data &#8212; ISYE 6420 - BUGS to PyMC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "areding/6420-pymc");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ðŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">ISYE 6420 - BUGS to PyMC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit1.html">
   A Simple Regression
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit2.html">
   Code for Unit 2
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit3-TwoHeadedCoin.html">
   Two-headed Coin
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit3-ManufacturingBayes.html">
   Manufacturing Bayes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit3-Alarm.html">
   Alarm
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 4
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit4-BetaPriors.html">
   Beta plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit4-GammaGamma.html">
   Gamma Gamma
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit4-eBay.html">
   eBay Purchase Example
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 5
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit5-LaplacesMethod.html">
   Laplaceâ€™s Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit5-MetropolisHastings.html">
   Metropolis-Hastings Example 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit5-MetropolisHastings2.html">
   Metropolis-Hastings Example 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit5-GibbsSampler.html">
   Gibbs Sampler Example 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit5-PumpsMCMC.html">
   Gibbs Sampler Example 2: Pumps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit5-Gibbs3.html">
   Gibbs Sampler Example 3: Disasters
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 6
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-cheese.html">
   Taste of Cheese
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-DeMere.html">
   Demere
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-dugongs.html">
   Dugongs: Dealing with Missing Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-equivalence.html">
   Equivalence of Generic and Brand-Name Drugs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-exponential.html">
   Bartholomew (1957) for Type I censoring
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-psoriasis.html">
   Psoriasis: Two sample problem with paired data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-stressacids.html">
   Stress, Diet and Plasma Acids
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit6-zerotrickJeremy.html">
   Jeremy with Zero Tricks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 7
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit7-ants.html">
   Ants
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit7-arrhythmia.html">
   Arrhythmia
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit7-fat.html">
   Brozek index prediction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unit 8
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Unit8-gastric.html">
   Gastric cancer example
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/answers/gastric-testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/areding/6420-pymc"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/areding/6420-pymc/issues/new?title=Issue%20on%20page%20%2Fanswers/gastric-testing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/areding/6420-pymc/main?urlpath=tree/answers/gastric-testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/areding/6420-pymc/blob/main/answers/gastric-testing.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-changes">
   Model changes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method-1-pm-censored">
   Method 1:
   <code class="docutils literal notranslate">
    <span class="pre">
     pm.Censored
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method-2-imputed-censoring">
   Method 2: Imputed Censoring
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Gastric Cancer Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-changes">
   Model changes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method-1-pm-censored">
   Method 1:
   <code class="docutils literal notranslate">
    <span class="pre">
     pm.Censored
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method-2-imputed-censoring">
   Method 2: Imputed Censoring
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">pymc.math</span> <span class="kn">import</span> <span class="n">exp</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="gastric-cancer-data">
<h1>Gastric Cancer Data<a class="headerlink" href="#gastric-cancer-data" title="Permalink to this headline">Â¶</a></h1>
<p>Adapted from <a class="reference external" href="https://www2.isye.gatech.edu/isye6420/supporting.html">Codes for Unit 8: gastric.odc</a>.</p>
<p>Associated lecture video: <a class="reference external" href="https://www.youtube.com/watch?v=t4pHpZxtC0U&amp;list=PLv0FeK5oXK4l-RdT6DWJj0_upJOG2WKNO&amp;index=87">Unit 8 Lesson 6</a>.</p>
<p>Data can be found <a class="reference external" href="https://raw.githubusercontent.com/areding/6420-pymc/main/data/gastric.csv">here</a>.</p>
<p>Stablein et al. (1981) provide data on 90 patients affected by locally advanced, nonresectable gastric carcinoma. The patients are randomized to two treatments: chemotherapy alone (coded as 0) and chemotherapy plus radiation (coded as 1). Survival time is reported in days. Recorded times are censored if the patient stopped participating in the study before it finished.</p>
<p>Stablein, D. M., Carter, W. H., Novak, J. W. (1981). Analysis of survival data with nonproportional hazard functions. Control. Clin. Trials,  2 , 2, 149â€“159.</p>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">Â¶</a></h2>
<p>Columns are, from left to right:</p>
<ul class="simple">
<li><p>type: Treatment type, chemotherapy (0) or chemotherapy + radiation (1)</p></li>
<li><p>censored: If censored, meaning the patient survived the observation period, the time in days appears here rather than in the times column. 0 if not censored.</p></li>
<li><p>times: Recorded days without cancer recurrence. NaN if censored.</p></li>
</ul>
</div>
<div class="section" id="model-changes">
<h2>Model changes<a class="headerlink" href="#model-changes" title="Permalink to this headline">Â¶</a></h2>
<p>I didnâ€™t implement S, f, or h from the original model. They should be simple enough, but I really just wanted to get another example of censoring up before HW6. I will add those later.</p>
<p>PyMC really did not like the noninformative exponential prior on v (Î± in this model). To avoid the divide by zero errors, I just kept increasing lambda until the model ran all the way through. This is not ideal, but I havenâ€™t had time to look into it further. The results actually came out fairly close to the BUGS results.</p>
</div>
<div class="section" id="method-1-pm-censored">
<h2>Method 1: <code class="docutils literal notranslate"><span class="pre">pm.Censored</span></code><a class="headerlink" href="#method-1-pm-censored" title="Permalink to this headline">Â¶</a></h2>
<p>The way PyMC censoring works is described in some detail in <a class="reference external" href="https://docs.pymc.io/projects/examples/en/latest/generalized_linear_models/GLM-truncated-censored-regression.html#censored-regression-model">this notebook</a> by <a class="reference external" href="https://github.com/drbenvincent">Dr. Benjamin T. Vincent</a>. This is accomplished in the code <a class="reference external" href="https://github.com/aesara-devs/aeppl/blob/751979802f1aef5478fdbf7cc1839df07df60825/aeppl/truncation.py#L79">here</a> if you want to take a look. For right-censoring, try this: <code class="docutils literal notranslate"><span class="pre">pm.Censored(&quot;name&quot;,</span> <span class="pre">dist,</span> <span class="pre">lower=None,</span> <span class="pre">upper=censored,</span> <span class="pre">observed=y)</span></code>. The censored values can be an array of the same shape as the y values.</p>
<p>If the y value equals the right-censored value, <a class="reference external" href="https://docs.pymc.io/en/latest/api/distributions/generated/pymc.Censored.html#pymc.Censored"><code class="docutils literal notranslate"><span class="pre">pm.Censored</span></code></a> returns the complement to the CDF evaluated at the censored value. If the y value is greater than the censored value, it returns <code class="docutils literal notranslate"><span class="pre">-np.inf</span></code>. Otherwise, the distribution you passed to the <code class="docutils literal notranslate"><span class="pre">dist</span></code> parameter works as normal. What Iâ€™ve been doing is setting the values in the censored array to <code class="docutils literal notranslate"><span class="pre">np.inf</span></code> if the corresponding y value is not censored, and equal to the y value if it should be censored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;./data/gastric.txt&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [7],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;./data/gastric.txt&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">data</span>

<span class="nn">File ~/mambaforge/envs/pymc-dev-py39/lib/python3.9/site-packages/numpy/lib/npyio.py:1042,</span> in <span class="ni">loadtxt</span><span class="nt">(fname, dtype, comments, delimiter, converters, skiprows, usecols, unpack, ndmin, encoding, max_rows, like)</span>
<span class="g g-Whitespace">   </span><span class="mi">1040</span>     <span class="n">fname</span> <span class="o">=</span> <span class="n">os_fspath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> <span class="k">if</span> <span class="n">_is_string_like</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1042</span>     <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">_datasource</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1043</span>     <span class="n">fencoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1044</span>     <span class="n">line_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/pymc-dev-py39/lib/python3.9/site-packages/numpy/lib/_datasource.py:193,</span> in <span class="ni">open</span><span class="nt">(path, mode, destpath, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="sd"> Open `path` with `mode` and return the file object.</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">190</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">(</span><span class="n">destpath</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">193</span> <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/pymc-dev-py39/lib/python3.9/site-packages/numpy/lib/_datasource.py:532,</span> in <span class="ni">DataSource.open</span><span class="nt">(self, path, mode, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span>     <span class="k">return</span> <span class="n">_file_openers</span><span class="p">[</span><span class="n">ext</span><span class="p">](</span><span class="n">found</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">530</span>                               <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">531</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">532</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: ./data/gastric.txt not found.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">censored</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># for pymc, right-censored values must be greater than or equal to than the &quot;upper&quot; value</span>
<span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">censored</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
<span class="n">censored</span><span class="p">[</span><span class="n">censored</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  17.,   42.,   44.,   48.,   60.,   72.,   74.,   95.,  103.,
        108.,  122.,  144.,  167.,  170.,  183.,  185.,  193.,  195.,
        197.,  208.,  234.,  235.,  254.,  307.,  315.,  401.,  445.,
        464.,  484.,  528.,  542.,  567.,  577.,  580.,  795.,  855.,
        882.,  892., 1031., 1033., 1306., 1335., 1366., 1452., 1472.,
          1.,   63.,  105.,  129.,  182.,  216.,  250.,  262.,  301.,
        301.,  342.,  354.,  356.,  358.,  380.,  381.,  383.,  383.,
        388.,  394.,  408.,  460.,  489.,  499.,  524.,  529.,  535.,
        562.,  675.,  676.,  748.,  748.,  778.,  786.,  797.,  945.,
        955.,  968., 1180., 1245., 1271., 1277., 1397., 1512., 1519.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">censored</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,
         inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,
         inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,
         inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,
        882.,  892., 1031., 1033., 1306., 1335.,   inf, 1452., 1472.,
         inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,
         inf,   inf,   inf,   inf,   inf,   inf,  381.,   inf,   inf,
         inf,   inf,   inf,   inf,   inf,   inf,   inf,  529.,   inf,
         inf,   inf,   inf,   inf,   inf,   inf,   inf,   inf,  945.,
         inf,   inf, 1180.,   inf,   inf, 1277., 1397., 1512., 1519.])
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PyMC and BUGS do not specify the Weibull distribution in the same way!</p>
<p>Î± = v
Î² = Î» ** (-1 / Î±)</p>
</div>
<div class="cell tag_hide_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;beta0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;beta1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
    <span class="n">Î±</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="s2">&quot;Î±&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">Î»</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">Î²</span> <span class="o">=</span> <span class="n">Î»</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">)</span>

    <span class="n">obs_latent</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Weibull</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">Î±</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">Î²</span><span class="p">)</span>
    <span class="n">likelihood</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Censored</span><span class="p">(</span>
        <span class="s2">&quot;likelihood&quot;</span><span class="p">,</span>
        <span class="n">obs_latent</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="n">censored</span><span class="p">,</span>
        <span class="n">observed</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">median0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;median0&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta0</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">))</span>
    <span class="n">median1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;median1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta0</span> <span class="o">-</span> <span class="n">beta1</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">))</span>

    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="p">[</span><span class="n">pm</span><span class="o">.</span><span class="n">Metropolis</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Multiprocess sampling (4 chains in 4 jobs)
CompoundStep
&gt;ABCMeta: []
&gt;NUTS: [beta0, beta1, Î±]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
  <progress value='0' class='' max='48000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  0.00% [0/48000 00:00<00:00 Sampling 4 chains, 0 divergences]
</div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_5%</th>
      <th>hdi_95%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>beta0</th>
      <td>-6.617</td>
      <td>0.653</td>
      <td>-7.693</td>
      <td>-5.560</td>
      <td>0.006</td>
      <td>0.004</td>
      <td>12089.0</td>
      <td>14776.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>beta1</th>
      <td>0.261</td>
      <td>0.237</td>
      <td>-0.120</td>
      <td>0.652</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>16776.0</td>
      <td>17473.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Î±</th>
      <td>1.001</td>
      <td>0.096</td>
      <td>0.845</td>
      <td>1.158</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>12390.0</td>
      <td>15220.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>median0</th>
      <td>519.732</td>
      <td>90.135</td>
      <td>378.011</td>
      <td>665.981</td>
      <td>0.616</td>
      <td>0.435</td>
      <td>21255.0</td>
      <td>23280.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>median1</th>
      <td>400.156</td>
      <td>71.182</td>
      <td>287.236</td>
      <td>515.158</td>
      <td>0.476</td>
      <td>0.338</td>
      <td>22376.0</td>
      <td>24715.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="method-2-imputed-censoring">
<h2>Method 2: Imputed Censoring<a class="headerlink" href="#method-2-imputed-censoring" title="Permalink to this headline">Â¶</a></h2>
<p>This method is from <a class="reference external" href="https://docs.pymc.io/projects/examples/en/latest/survival_analysis/censored_data.html#censored-data-model1">this notebook</a> by <a class="reference external" href="https://github.com/domenzain">Luis Mario Domenzain</a>, <a class="reference external" href="https://github.com/eigenfoo">George Ho</a>, and <a class="reference external" href="https://github.com/drbenvincent">Dr. Ben Vincent</a>. This method imputes the values using what is almost another likelihood (not sure if it actually meets the definition of one, so Iâ€™m calling the variable <code class="docutils literal notranslate"><span class="pre">impute_censored</span></code>) in the model, with the right-censored values as lower bounds. Since the two likelihoods share the same priors, this ends up working nearly as well as the previous method. Actually better, in the case of homework 6 question 2, since the previous method doesnâ€™t seem to work for the required model at all!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;../data/gastric.txt&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">censored_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">not_observed_mask</span> <span class="o">=</span> <span class="n">censored_vals</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">censored</span> <span class="o">=</span> <span class="n">censored_vals</span><span class="p">[</span><span class="n">not_observed_mask</span><span class="p">]</span>
<span class="n">y_uncensored</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">not_observed_mask</span><span class="p">]</span>
<span class="n">x_censored</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">not_observed_mask</span><span class="p">]</span>
<span class="n">x_uncensored</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">not_observed_mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;beta0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;beta1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
    <span class="n">Î±</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="s2">&quot;Î±&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">Î»_censored</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x_censored</span><span class="p">)</span>
    <span class="n">Î²_censored</span> <span class="o">=</span> <span class="n">Î»_censored</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">)</span>

    <span class="n">Î»_uncensored</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x_uncensored</span><span class="p">)</span>
    <span class="n">Î²_uncensored</span> <span class="o">=</span> <span class="n">Î»_uncensored</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">)</span>

    <span class="n">impute_censored</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span>
        <span class="s2">&quot;impute_censored&quot;</span><span class="p">,</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Weibull</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">Î±</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">Î²_censored</span><span class="p">),</span>
        <span class="n">lower</span><span class="o">=</span><span class="n">censored</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">censored</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">likelihood</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Weibull</span><span class="p">(</span>
        <span class="s2">&quot;likelihood&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">Î±</span><span class="p">,</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">Î²_uncensored</span><span class="p">,</span>
        <span class="n">observed</span><span class="o">=</span><span class="n">y_uncensored</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">y_uncensored</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">median0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;median0&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta0</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">))</span>
    <span class="n">median1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;median1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta0</span> <span class="o">-</span> <span class="n">beta1</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">))</span>

    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="mi">10000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="p">[</span><span class="n">pm</span><span class="o">.</span><span class="n">NUTS</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [12],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">Î»_uncensored</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x_uncensored</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">Î²_uncensored</span> <span class="o">=</span> <span class="n">Î»_uncensored</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">impute_censored</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="s2">&quot;impute_censored&quot;</span><span class="p">,</span>
<span class="ne">---&gt; </span><span class="mi">14</span>     <span class="n">pm</span><span class="o">.</span><span class="n">Weibull</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">Î±</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">Î²_cens</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">lower</span><span class="o">=</span><span class="n">censored</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">shape</span><span class="o">=</span><span class="n">censored</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Weibull</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="s2">&quot;likelihood&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">alpha</span><span class="o">=</span><span class="n">Î±</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">shape</span><span class="o">=</span><span class="n">y_uncensored</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">median0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;median0&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta0</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Î±</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;Î²_cens&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_2.5%</th>
      <th>hdi_97.5%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>beta0</th>
      <td>-6.747</td>
      <td>0.662</td>
      <td>-8.059</td>
      <td>-5.470</td>
      <td>0.004</td>
      <td>0.003</td>
      <td>22386.0</td>
      <td>22192.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>beta1</th>
      <td>0.263</td>
      <td>0.233</td>
      <td>-0.194</td>
      <td>0.723</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>42748.0</td>
      <td>29654.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Î±</th>
      <td>1.021</td>
      <td>0.097</td>
      <td>0.834</td>
      <td>1.212</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>22191.0</td>
      <td>21764.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[0]</th>
      <td>1451.379</td>
      <td>605.188</td>
      <td>882.017</td>
      <td>2630.015</td>
      <td>2.814</td>
      <td>2.098</td>
      <td>29824.0</td>
      <td>16865.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[1]</th>
      <td>1467.201</td>
      <td>609.670</td>
      <td>892.031</td>
      <td>2661.425</td>
      <td>2.886</td>
      <td>2.138</td>
      <td>30214.0</td>
      <td>16918.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[2]</th>
      <td>1599.929</td>
      <td>609.118</td>
      <td>1031.034</td>
      <td>2757.275</td>
      <td>2.816</td>
      <td>2.095</td>
      <td>30065.0</td>
      <td>18023.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[3]</th>
      <td>1598.762</td>
      <td>602.081</td>
      <td>1033.027</td>
      <td>2750.599</td>
      <td>2.789</td>
      <td>2.064</td>
      <td>32297.0</td>
      <td>18540.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[4]</th>
      <td>1874.160</td>
      <td>609.180</td>
      <td>1306.018</td>
      <td>3037.794</td>
      <td>2.823</td>
      <td>2.087</td>
      <td>30803.0</td>
      <td>19025.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[5]</th>
      <td>1902.432</td>
      <td>605.028</td>
      <td>1335.010</td>
      <td>3053.389</td>
      <td>2.852</td>
      <td>2.104</td>
      <td>32254.0</td>
      <td>18788.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[6]</th>
      <td>2022.598</td>
      <td>624.856</td>
      <td>1452.038</td>
      <td>3220.435</td>
      <td>2.955</td>
      <td>2.161</td>
      <td>26631.0</td>
      <td>14986.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[7]</th>
      <td>2045.947</td>
      <td>618.046</td>
      <td>1472.012</td>
      <td>3239.206</td>
      <td>2.934</td>
      <td>2.142</td>
      <td>29023.0</td>
      <td>16518.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[8]</th>
      <td>1123.343</td>
      <td>785.800</td>
      <td>381.012</td>
      <td>2633.221</td>
      <td>3.617</td>
      <td>2.764</td>
      <td>32237.0</td>
      <td>18484.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[9]</th>
      <td>1272.929</td>
      <td>789.095</td>
      <td>529.013</td>
      <td>2791.777</td>
      <td>3.616</td>
      <td>2.767</td>
      <td>32368.0</td>
      <td>17466.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[10]</th>
      <td>1688.054</td>
      <td>790.809</td>
      <td>945.014</td>
      <td>3220.577</td>
      <td>3.715</td>
      <td>2.778</td>
      <td>29818.0</td>
      <td>16603.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[11]</th>
      <td>1925.382</td>
      <td>801.767</td>
      <td>1180.005</td>
      <td>3478.527</td>
      <td>3.601</td>
      <td>2.726</td>
      <td>36210.0</td>
      <td>19155.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[12]</th>
      <td>2019.599</td>
      <td>791.059</td>
      <td>1277.008</td>
      <td>3545.835</td>
      <td>3.687</td>
      <td>2.755</td>
      <td>32035.0</td>
      <td>18231.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[13]</th>
      <td>2137.184</td>
      <td>793.619</td>
      <td>1397.011</td>
      <td>3694.902</td>
      <td>3.702</td>
      <td>2.732</td>
      <td>30165.0</td>
      <td>18656.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[14]</th>
      <td>2255.157</td>
      <td>802.178</td>
      <td>1512.078</td>
      <td>3822.936</td>
      <td>3.721</td>
      <td>2.756</td>
      <td>31967.0</td>
      <td>18231.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>right_censored[15]</th>
      <td>2259.039</td>
      <td>796.086</td>
      <td>1519.003</td>
      <td>3804.633</td>
      <td>3.696</td>
      <td>2.720</td>
      <td>31334.0</td>
      <td>17538.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>median0</th>
      <td>523.309</td>
      <td>88.513</td>
      <td>359.251</td>
      <td>699.899</td>
      <td>0.460</td>
      <td>0.330</td>
      <td>37850.0</td>
      <td>32370.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>median1</th>
      <td>404.253</td>
      <td>70.293</td>
      <td>273.714</td>
      <td>544.513</td>
      <td>0.337</td>
      <td>0.242</td>
      <td>44272.0</td>
      <td>35717.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_censored</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 882.,  892., 1031., 1033., 1306., 1335., 1452., 1472.,  381.,
        529.,  945., 1180., 1277., 1397., 1512., 1519.])
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./answers"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Aaron Reding<br/>
    
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>